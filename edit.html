<!DOCTYPE html>
<html>
<body>
  <textarea id="editor"></textarea>
  <button id="saveBtn">保存</button>
  <div id="status"></div>

  <script>
    // 配置区（替换为你的信息↓↓↓）
    const CONFIG = {
      owner: "zunzunDeveloper",
      repo: "text",
      file: "content.txt",
    };

    // 主逻辑
    document.addEventListener("DOMContentLoaded", async () => {
      const editor = document.getElementById("editor");
      const saveBtn = document.getElementById("saveBtn");
      const status = document.getElementById("status");

      // 加载内容
      async function loadContent() {
        try {
          const res = await fetch(
            `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.file}`,
            {
              headers: {
                "Authorization": `Bearer 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`,
                "Accept": "application/vnd.github.v3+json"
              }
            }
          );
          const data = await res.json();
          editor.value = decodeURIComponent(escape(atob(data.content)));
        } catch (err) {
          status.textContent = "首次使用，将创建新文件";
        }
      }

      // 保存内容
      async function saveContent() {
        try {
          // 获取文件SHA（如果存在）
          let sha = null;
          try {
            const res = await fetch(
              `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.file}`,
              { headers: { "Authorization": `Bearer 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` } }
            );
            sha = (await res.json()).sha;
          } catch {}

          // 提交更新
          await fetch(
            `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.file}`,
            {
              method: "PUT",
              headers: {
                "Authorization": `Bearer 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`,
                "Content-Type": "application/json"
              },
              body: JSON.stringify({
                message: "网页更新",
                content: btoa(unescape(encodeURIComponent(editor.value))),
                sha
              })
            }
          );
          status.textContent = "✅ 保存成功！";
        } catch (err) {
          status.textContent = "❌ 失败: " + err.message;
        }
      }

      // 初始化
      loadContent();
      saveBtn.addEventListener("click", saveContent);
    });
  </script>
</body>
</html>
