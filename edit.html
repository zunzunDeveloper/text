<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>编辑内容</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    textarea {
      width: 100%;
      height: 300px;
      padding: 10px;
      font-size: 16px;
    }
    button {
      padding: 10px 20px;
      background: #28a745;
      color: white;
      border: none;
      cursor: pointer;
      margin-top: 10px;
    }
    #status {
      margin-top: 10px;
      color: green;
    }
  </style>
</head>
<body>
  <h1>编辑内容</h1>
  <textarea id="contentEditor"></textarea>
  <button id="saveBtn">保存</button>
  <div id="status"></div>

  <script>
        const REPO = "zunzunDeveloper/text";
        const FILE_PATH = "content.txt";
        const TOKEN = "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"; 

        document.addEventListener('DOMContentLoaded', async () => {
            const editor = document.getElementById('contentEditor');
            const saveBtn = document.getElementById('saveBtn');
            const status = document.getElementById('status');

            // 加载现有内容
            try {
                const response = await fetch(
                    `https://raw.githubusercontent.com/${REPO}/contents/${FILE_PATH}`
                );
                editor.value = await response.text();
            } catch (error) {
                status.textContent = "首次使用，将创建新文件。";
            }

            // 保存到 GitHub
            saveBtn.addEventListener('click', async () => {
                const content = editor.value;
                const message = "Update content via edit.html";

                try {
                    // 获取文件 SHA（如果已存在）
                    let sha = null;
                    try {
                        const getResponse = await fetch(
                            `https://api.github.com/repos/${REPO}/contents/${FILE_PATH}`,
                            { headers: { 'Authorization': `token ${TOKEN}` } }
                        );
                        sha = (await getResponse.json()).sha;
                    } catch {} // 忽略文件不存在的错误

                    // 提交更新
                    const updateResponse = await fetch(
                        `https://api.github.com/repos/${REPO}/contents/${FILE_PATH}`,
                        {
                            method: 'PUT',
                            headers: {
                                'Authorization': `token ${TOKEN}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                message,
                                content: btoa(unescape(encodeURIComponent(content))), // 处理中文
                                sha
                            })
                        }
                    );

                    status.textContent = "✅ 保存成功！";
                } catch (error) {
                    status.textContent = "❌ 保存失败：" + error.message;
                }
            });
        });
    </script>
</body>
</html>
